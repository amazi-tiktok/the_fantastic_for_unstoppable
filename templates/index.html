<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Quality Assessment System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 700px;
        }
        
        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
        }
        
        .results-section {
            padding: 30px;
            background: white;
            overflow-y: auto;
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        
        .form-section h3::before {
            content: "üë§";
            margin-right: 8px;
        }
        
        .form-section.store h3::before {
            content: "üè™";
        }
        
        .form-section.system h3::before {
            content: "üîó";
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .rating-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 8px;
        }
        
        .star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star.active, .star:hover {
            color: #ffc107;
        }
        
        .analyze-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .analyze-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .example-btn {
            background: #34495e;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .example-btn:hover {
            background: #2c3e50;
            transform: translateY(-1px);
        }
        
        .results-container {
            display: none;
        }
        
        .results-container.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .overall-score {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .overall-score.approve {
            background: linear-gradient(45deg, #00b894, #00cec9);
        }
        
        .overall-score.flag {
            background: linear-gradient(45deg, #fdcb6e, #f39c12);
        }
        
        .overall-score h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .score-value {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .policy-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }
        
        .policy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .policy-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .policy-score {
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .policy-score.low {
            background: #27ae60;
        }
        
        .policy-score.medium {
            background: #f39c12;
        }
        
        .violations-list {
            list-style: none;
            padding: 0;
        }
        
        .violations-list li {
            background: #fff;
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #e74c3c;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .metadata-section {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
        }
        
        .metadata-section h4 {
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metadata-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .metadata-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .metadata-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Review Quality Assessment</h1>
            <p>Professional ML-powered system to detect policy violations and assess review quality</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">üìù Review & Store Information</h2>
                
                <!-- Review Information Section -->
                <div class="form-section">
                    <h3>Review Information</h3>
                    
                    <div class="form-group">
                        <label for="userName">Reviewer Name</label>
                        <input type="text" id="userName" placeholder="e.g., Jordan Adams">
                    </div>
                    
                    <div class="form-group">
                        <label for="reviewText">Review Text</label>
                        <textarea id="reviewText" placeholder="Enter the review content here..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="imageURL">Image inside review URL (Optional)</label>
                        <input type="url" id="imageURL" placeholder="https://picsum.photos/400">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Rating</label>
                            <div class="rating-input">
                                <span class="star" data-rating="1">‚≠ê</span>
                                <span class="star" data-rating="2">‚≠ê</span>
                                <span class="star" data-rating="3">‚≠ê</span>
                                <span class="star" data-rating="4">‚≠ê</span>
                                <span class="star" data-rating="5">‚≠ê</span>
                                <span id="ratingValue" style="margin-left: 15px; font-weight: bold;">5/5</span>
                            </div>
                            <input type="hidden" id="rating" value="5">
                        </div>
                        <div class="form-group">
                            <label for="reviewTime">Review Date</label>
                            <input type="datetime-local" id="reviewTime">
                        </div>
                    </div>
                </div>
                
                <!-- Store Information Section -->
                <div class="form-section store">
                    <h3>Store Information</h3>
                    
                    <div class="form-group">
                        <label for="storeName">Store Name</label>
                        <input type="text" id="storeName" placeholder="e.g., Walgreens Pharmacy">
                    </div>
                    
                    <div class="form-group">
                        <label for="storeDescription">Store Description</label>
                        <textarea id="storeDescription" placeholder="Brief description of the business..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeCategory">Store Category</label>
                        <select id="storeCategory">
                            <option value="Pharmacy">Pharmacy</option>
                            <option value="Restaurant">Restaurant</option>
                            <option value="Retail">Retail Store</option>
                            <option value="Gas Station">Gas Station</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Automotive">Automotive</option>
                            <option value="Beauty">Beauty & Spa</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Hotel">Hotel</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                
                <!-- System Information Section -->
                <div class="form-section system">
                    <h3>System Information</h3>
                    
                    <div class="form-group">
                        <label for="gcomId">GCOM ID</label>
                        <input type="text" id="gcomId" placeholder="Unique identifier linking review to store" value="GCOM_12345">
                    </div>
                </div>
                
                <button class="example-btn" onclick="loadExampleData()">üìã Load Example Data</button>
                
                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeReview()">
                    üöÄ Analyze Review Quality
                </button>
            </div>
            
            <div class="results-section">
                <h2 class="section-title">üìä Analysis Results</h2>
                
                <div id="loadingIndicator" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analyzing review quality and policy violations...</p>
                </div>
                
                <div id="resultsContainer" class="results-container">
                    <div style="text-align: center; padding: 80px 20px; color: #6c757d;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üéØ</div>
                        <h3 style="margin-bottom: 15px;">Ready to Analyze</h3>
                        <p>Fill in the review and store information, then click "Analyze Review Quality" to see comprehensive policy violation detection and quality assessment.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Rating system
        let currentRating = 5;
        const stars = document.querySelectorAll('.star');
        const ratingValue = document.getElementById('ratingValue');
        const ratingInput = document.getElementById('rating');
        
        stars.forEach((star, index) => {
            star.addEventListener('click', () => {
                currentRating = index + 1;
                updateRating();
            });
            
            star.addEventListener('mouseover', () => {
                highlightStars(index + 1);
            });
        });
        
        document.querySelector('.rating-input').addEventListener('mouseleave', () => {
            highlightStars(currentRating);
        });
        
        function highlightStars(rating) {
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }
        
        function updateRating() {
            highlightStars(currentRating);
            ratingValue.textContent = `${currentRating}/5`;
            ratingInput.value = currentRating;
        }
        
        // Initialize rating
        updateRating();
        
        function loadExampleData() {
            document.getElementById('userName').value = 'Jordan Adams';
            document.getElementById('reviewText').value = 'Cool place, great people, awesome dentist!';
            document.getElementById('imageURL').value = 'https://picsum.photos/400';
            document.getElementById('storeName').value = 'Walgreens Pharmacy';
            document.getElementById('storeDescription').value = 'Department of the Walgreens chain providing prescription medications & other health-related items.';
            document.getElementById('storeCategory').value = 'Pharmacy';
            document.getElementById('gcomId').value = 'GCOM_12345';
            
            // Set current date
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('reviewTime').value = now.toISOString().slice(0, 16);
            
            currentRating = 5;
            updateRating();
        }
        
        async function analyzeReview() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true; // Disable button
    
            // Collect form data
            const reviewData = {
                name: document.getElementById('userName').value,
                text: document.getElementById('reviewText').value,
                rating: parseInt(document.getElementById('rating').value),
                time: new Date(document.getElementById('reviewTime').value || new Date()).getTime(),
                image_url: document.getElementById('imageURL').value
            };
            
            const storeInfo = {
                name: document.getElementById('storeName').value,
                description: document.getElementById('storeDescription').value,
                category: [document.getElementById('storeCategory').value]
            };
            
            const gcomId = document.getElementById('gcomId').value;
            
            // Validation
            if (!reviewData.text || !storeInfo.name) {
                alert('Please fill in at least the review text and store name');
                return;
            }
            
            try {
                // Show loading
                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('resultsContainer').classList.remove('show');
                
                // Make API call
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        review_data: reviewData,
                        store_info: storeInfo,
                        gcom_id: gcomId
                    })
                });
                
                const results = await response.json();
                
                // Hide loading
                document.getElementById('loadingIndicator').style.display = 'none';
                
                // Display results
                displayResults(results);
                
            } catch (error) {
                document.getElementById('loadingIndicator').style.display = 'none';
                alert('Error analyzing review: ' + error.message);
            } finally {
                analyzeBtn.disabled = false; // Re-enable button
            }
        }
        
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            
            const actionClass = results.action.toLowerCase();
            const scoreColor = results.overall_violation_score > 0.7 ? 'remove' : 
                              results.overall_violation_score > 0.4 ? 'flag' : 'approve';
            
            container.innerHTML = `
                <div class="overall-score ${scoreColor}">
                    <h3>Overall Assessment</h3>
                    <div class="score-value">${(results.overall_violation_score * 100).toFixed(1)}%</div>
                    <p>Policy Violation Score</p>
                    <div style="margin-top: 20px; font-size: 1.5rem; font-weight: bold; padding: 10px 20px; background: rgba(255,255,255,0.2); border-radius: 25px; display: inline-block;">
                        üìã Action: ${results.action}
                    </div>
                </div>
                
                <h3 style="margin-bottom: 25px; color: #2c3e50; font-size: 1.4rem;">üõ°Ô∏è Policy Violation Analysis</h3>
                
                ${Object.entries(results.policy_violations).map(([policy, data]) => `
                    <div class="policy-section">
                        <div class="policy-header">
                            <div class="policy-title">${policy.charAt(0).toUpperCase() + policy.slice(1).replace('_', ' ')}</div>
                            <div class="policy-score ${data.score < 0.3 ? 'low' : data.score < 0.6 ? 'medium' : 'high'}">
                                ${(data.score * 100).toFixed(1)}%
                            </div>
                        </div>
                        ${data.violations.length > 0 ? `
                            <ul class="violations-list">
                                ${data.violations.map(violation => `<li>‚ö†Ô∏è ${violation}</li>`).join('')}
                            </ul>
                        ` : '<p style="color: #27ae60; font-style: italic; padding: 10px; background: rgba(39, 174, 96, 0.1); border-radius: 8px;">‚úÖ No violations detected</p>'}
                    </div>
                `).join('')}
                
                <div class="metadata-section">
                    <h4>üìä Analysis Metadata</h4>
                    <div class="metadata-item" style="margin-bottom: 24px;">
                        <div class="metadata-label">Image In Review</div>
                        <div class="metadata-value">
                            ${results.metadata.image_url ? 
                            `<img src="${results.metadata.image_url}" style="width: 100px; height: 100px; object-fit: cover; display: block; margin-bottom: 12px;">` : 
                            'No image provided'
                            }
                        </div>
                    </div>
                    <div class="metadata-grid">
                        <div class="metadata-item">
                            <div class="metadata-label">GCOM ID</div>
                            <div class="metadata-value">${results.gcom_id}</div>
                        </div>
                        <div class="metadata-item">
                            <div class="metadata-label">Review Length</div>
                            <div class="metadata-value">${results.metadata.review_length} words</div>
                        </div>
                        <div class="metadata-item">
                            <div class="metadata-label">User Rating</div>
                            <div class="metadata-value">${results.metadata.rating}/5 ‚≠ê</div>
                        </div>
                        <div class="metadata-item">
                            <div class="metadata-label">Analysis Time</div>
                            <div class="metadata-value">${new Date(results.metadata.analysis_timestamp).toLocaleString()}</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.classList.add('show');
        }
        
        // Load example data on page load
        window.onload = function() {
            loadExampleData();
        };
    </script>
</body>
</html>